<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/schecule.css">
</head>
<body>
    <header>
        <nav>
            <a href="/">
                <img src="/assets/myrock-logo.png" id="myrock-logo">
            </a>
            <div id="menu">
                <a href="/about">소개</a>
                <a href="/schedule" class="selected">공연 일정</a>
                <a href="/news">공지사항</a>
                <a href="/cloud">클라우드</a>
                <a href="/link">외부 링크</a>
            </div>
            <a href="/login" id="log-in">로그인</a>
        </nav>
    </header>
    <div id="layout">
        <main>
            <div id="content">
                <div class="wrap">
                    <ul class="board" id="schedule-board">
                        <li class="head">
                            <span class="title">제목</span>
                            <span class="date">날짜</span>
                        </li>

                    </ul>
                    <p>* 운영자 계정으로 로그인해서 게시글을 추가할 수 있도록 할 예정. 지금은 공연 링크만 연결해놓은 상태인데, 필요하면 공지사항처럼 게시글처럼 만들 수 있다.</p>
                </div>
            </div>
        </main>
    </div>
    
    <script type="module">
        // ===== 1. Firebase SDK 불러오기 =====
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import {
        getFirestore,
        collection,
        getDocs,
        query,
        orderBy
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // ===== 2. firebaseConfig =====
        const firebaseConfig = {
            apiKey: "AIzaSyC-2H282ITWdqBTYVJBsoC0gnA9Y-xl4LM",
            authDomain: "skku-myrock.firebaseapp.com",
            projectId: "skku-myrock",
            storageBucket: "skku-myrock.firebasestorage.app",
            messagingSenderId: "42597556706",
            appId: "1:42597556706:web:6f6cde9d80c43cf94a59bb"
        };

        // ===== 3. Firebase 초기화 =====
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ===== 4. HTML 목록 위치 =====
        const board = document.getElementById("schedule-board");

        // ===== 5. Firestore → HTML 출력 함수 =====
        function addRow(title, link, timestamp) {
            const li = document.createElement("li");
            const d = timestamp.toDate();

            // YYYY-MM-DD 포맷
            const year  = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, "0");
            const day   = String(d.getDate()).padStart(2, "0");

            const formattedDate = `${year}-${month}-${day}`;

            li.innerHTML = `
                <span class="title">
                    <a href="${link}" target="_blank">${title}</a>
                </span>
                <span class="date">${formattedDate}</span>
            `;

            board.appendChild(li);
        }

        // ===== 6. Firestore 데이터 불러오기 =====
        async function loadSchedules() {
            const q = query(
                collection(db, "schedules"),
                orderBy("date", "desc")
            );

            const snapshot = await getDocs(q);

            snapshot.forEach(doc => {
                const data = doc.data();
                addRow(data.title, data.link, data.date);
            });
        }

        // ===== 7. 실행 =====
        loadSchedules();
    </script>
</body>
</html>